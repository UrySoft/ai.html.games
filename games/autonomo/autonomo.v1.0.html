<!DOCTYPE html>
<html lang="es" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard de Facturación para Autónomos en España</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap');
        :root { --bg-color: #f4f7f9; --card-bg: #ffffff; --text-primary: #1a202c; --text-secondary: #5a677d; --border-color: #e2e8f0; --primary-color: #3b82f6; --primary-color-light: #dbeafe; --success-color: #16a34a; --danger-color: #dc2626; --shadow-color: rgba(0, 0, 0, 0.05); --chart-grid-color: rgba(0, 0, 0, 0.1); --chart-label-color: #5a677d; --link-color: #3b82f6; }
        [data-theme="dark"] { --bg-color: #0f172a; --card-bg: #1e293b; --text-primary: #f1f5f9; --text-secondary: #94a3b8; --border-color: #334155; --primary-color: #60a5fa; --primary-color-light: #1e293b; --success-color: #4ade80; --danger-color: #f87171; --shadow-color: rgba(0, 0, 0, 0.2); --chart-grid-color: rgba(255, 255, 255, 0.1); --chart-label-color: #94a3b8; --link-color: #60a5fa; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background-color: var(--bg-color); color: var(--text-primary); transition: background-color 0.3s ease, color 0.3s ease; }
        .container { max-width: 1400px; margin: 0 auto; padding: 1.5rem; }
        header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; flex-wrap: wrap; gap: 1rem; }
        .header-title { margin-right: 1rem; }
        header h1 { font-size: 1.75rem; font-weight: 700; }
        .subtitle { font-size: 0.9rem; color: var(--text-secondary); margin-top: 0.25rem; }
        .subtitle a { color: var(--link-color); text-decoration: none; font-weight: 500; }
        .subtitle a:hover { text-decoration: underline; }
        .header-controls { display: flex; align-items: center; gap: 1.5rem; flex-wrap: wrap; }
        .control-group { display: flex; align-items: center; gap: 0.75rem; }
        .control-label { font-size: 0.9rem; color: var(--text-secondary); font-weight: 500; }
        .theme-switch { display: inline-block; height: 24px; position: relative; width: 48px; } .theme-switch input { display:none; }
        .slider { background-color: #ccc; bottom: 0; cursor: pointer; left: 0; position: absolute; right: 0; top: 0; transition: .4s; border-radius: 24px; }
        .slider:before { background-color: #fff; bottom: 4px; content: ""; height: 16px; left: 4px; position: absolute; transition: .4s; width: 16px; border-radius: 50%; }
        input:checked + .slider { background-color: var(--primary-color); } input:checked + .slider:before { transform: translateX(24px); }
        .main-grid { display: grid; grid-template-columns: 350px 1fr; gap: 1.5rem; }
        .card { background-color: var(--card-bg); border-radius: 12px; padding: 1.5rem; border: 1px solid var(--border-color); box-shadow: 0 4px 6px -1px var(--shadow-color), 0 2px 4px -2px var(--shadow-color); transition: all 0.3s ease; }
        .card h2 { font-size: 1.25rem; margin-bottom: 1.5rem; border-bottom: 1px solid var(--border-color); padding-bottom: 0.75rem; }
        .input-group { margin-bottom: 1.25rem; }
        .input-group label { display: block; font-size: 0.9rem; font-weight: 500; margin-bottom: 0.5rem; color: var(--text-primary); }
        .input-helper-text { font-size: 0.8rem; color: var(--text-secondary); margin-top: -0.25rem; margin-bottom: 0.5rem; }
        .input-field, .select-field { width: 100%; padding: 0.75rem; border: 1px solid var(--border-color); border-radius: 8px; background-color: var(--bg-color); color: var(--text-primary); font-size: 1rem; transition: all 0.2s ease; }
        .input-field:focus, .select-field:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 0 3px var(--primary-color-light); }
        #employee-list .employee-item { display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem; }
        .add-btn, .remove-btn { border: none; border-radius: 6px; padding: 0.5rem 0.75rem; cursor: pointer; font-weight: 500; transition: all 0.2s ease; }
        .add-btn { background-color: var(--primary-color-light); color: var(--primary-color); width: 100%; margin-top: 0.5rem; }
        .add-btn:hover { background-color: #bfe0ff; } [data-theme="dark"] .add-btn:hover { background-color: #334155; }
        .remove-btn { background-color: #fee2e2; color: #ef4444; padding: 0.75rem; line-height: 0; }
        .remove-btn:hover { background-color: #fecaca; } [data-theme="dark"] .remove-btn { background-color: #3f2222; } [data-theme="dark"] .remove-btn:hover { background-color: #5b2828; }
        .results-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 1.5rem; }
        .result-card { text-align: center; } .result-card .label { font-size: 1rem; color: var(--text-secondary); margin-bottom: 0.5rem; }
        .result-card .value { font-size: 2.5rem; font-weight: 700; color: var(--primary-color); } .result-card .unit { font-size: 1rem; color: var(--text-secondary); font-weight: 500; }
        .charts-grid { display: grid; grid-template-columns: 0.8fr 1.2fr; gap: 1.5rem; align-items: center; margin-bottom: 1.5rem; }
        .chart-container { position: relative; height: 350px; }
        footer { margin-top: 2rem; text-align: center; padding: 1.5rem; border-top: 1px solid var(--border-color); }
        .disclaimer { font-size: 0.9rem; color: var(--text-secondary); line-height: 1.6; max-width: 800px; margin: 0 auto; } .disclaimer strong { color: var(--text-primary); }
        .cashflow-item { display: flex; justify-content: space-between; align-items: center; padding: 0.75rem 0; border-bottom: 1px solid var(--border-color); font-size: 0.9rem; }
        .cashflow-item:last-child { border-bottom: none; }
        .cashflow-item .label { color: var(--text-secondary); } .cashflow-item .value { font-weight: 700; }
        .cashflow-item.inflow .value { color: var(--success-color); } .cashflow-item.outflow .value { color: var(--danger-color); }
        .cashflow-result { margin-top: 1rem; padding-top: 1rem; border-top: 2px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; }
        .cashflow-result .label { font-size: 1.1rem; font-weight: 700; } .cashflow-result .value { font-size: 1.5rem; font-weight: 700; }
        .cashflow-result .value.positive { color: var(--success-color); } .cashflow-result .value.negative { color: var(--danger-color); }
        .cashflow-explanation { font-size: 0.85rem; color: var(--text-secondary); margin-top: 1rem; padding: 0.75rem; background-color: var(--bg-color); border-radius: 6px; text-align: left; line-height: 1.5; border: 1px solid var(--border-color); }
        .cashflow-explanation strong { color: var(--text-primary); }
        @media (max-width: 1200px) { .charts-grid { grid-template-columns: 1fr; } .chart-container { height: 300px; } .chart-container:last-child { height: 250px; } }
        @media (max-width: 992px) { .main-grid { grid-template-columns: 1fr; } }
        @media (max-width: 768px) { header { align-items: flex-start; } .results-grid { grid-template-columns: 1fr; } .result-card .value { font-size: 2rem; } .container { padding: 1rem; } }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-title"><h1 data-translate="main_title">Dashboard de Facturación para Autónomos en España</h1><p class="subtitle" data-translate="subtitle">Creado por <a href="https://www.linkedin.com/in/oriol-badia" target="_blank" rel="noopener noreferrer">Oriol Badia Campanera</a></p></div>
            <div class="header-controls">
                <div class="control-group"><label class="control-label" for="lang-selector" data-translate="language_label">Idioma:</label><select id="lang-selector" class="select-field" style="width: auto;"></select></div>
                <div class="control-group"><span class="control-label" data-translate="dark_mode_label">Modo Oscuro</span><label class="theme-switch" for="theme-toggle"><input type="checkbox" id="theme-toggle" /><span class="slider"></span></label></div>
            </div>
        </header>
        <main class="main-grid">
            <aside id="inputs-section">
                <div class="card">
                    <h2 data-translate="inputs_title_monthly">1. Tus Datos (Mensuales)</h2>
                    <div class="input-group"><label for="neto-autonomo" data-translate="label_your_net_salary">Tu Sueldo Neto Mensual Deseado (€)</label><input type="number" id="neto-autonomo" class="input-field" value="2000" min="0"></div>
                    <div class="input-group"><label data-translate="label_your_team">Tu Equipo (Sueldo Neto Mensual por empleado en €)</label><div id="employee-list"><div class="employee-item"><input type="number" class="input-field employee-net-salary" value="1500" min="0" placeholder="Sueldo neto del empleado"><button class="remove-btn" aria-label="Eliminar empleado">X</button></div></div><button id="add-employee" class="add-btn" data-translate="btn_add_employee">+ Añadir Empleado</button></div>
                    <div class="input-group"><label for="otros-gastos" data-translate="label_other_expenses">Otros Gastos Fijos Mensuales (€)</label><p class="input-helper-text" data-translate="helper_other_expenses">Ej: alquiler, gestoría, software, etc.</p><input type="number" id="otros-gastos" class="input-field" value="450" min="0"></div>
                    <h2 data-translate="inputs_title_config">2. Configuración</h2>
                    <div class="input-group"><label for="period-selector" data-translate="label_view_mode">Ver Datos en modo:</label><select id="period-selector" class="select-field"></select></div>
                    <div class="input-group"><label for="iva" data-translate="label_vat_type">Tipo de IVA a aplicar (%)</label><select id="iva" class="select-field"><option value="0.21" selected>21% (General)</option><option value="0.10">10% (Reducido)</option><option value="0.04">4% (Superreducido)</option><option value="0">0% (Exento)</option></select></div>
                    <div class="input-group"><label for="retencion-irpf" data-translate="label_irpf_withholding">Retención de IRPF en facturas (%)</label><select id="retencion-irpf" class="select-field"><option value="0.15" selected>15% (Profesional)</option><option value="0.07">7% (Nuevos autónomos)</option><option value="0">0% (Sin retención)</option></select></div>
                    <div class="input-group"><label for="horas-facturables" data-translate="label_billable_hours">Horas Facturables al Mes</label><input type="number" id="horas-facturables" class="input-field" value="100" min="1"></div>
                </div>
            </aside>
            <section id="outputs-section">
                <div class="results-grid"><div class="card result-card"><div class="label" data-translate="kpi_total_billing_label">🎯 Total a Facturar (<span id="period-name-kpi"></span>)</div><div class="value" id="total-facturar">0 €</div></div><div class="card result-card"><div class="label" data-translate="kpi_hourly_rate_label">💰 Tarifa por Hora (sin IVA)</div><div class="value" id="tarifa-hora">0 €</div><div class="unit" data-translate="kpi_hourly_rate_unit">/ hora</div></div></div>
                <div class="card">
                    <h2 data-translate="title_visual_breakdown">Desglose Visual de la Facturación</h2>
                    <div class="charts-grid"><div class="chart-container"><canvas id="donutChart"></canvas></div><div class="chart-container"><canvas id="barChart"></canvas></div></div>
                    <div id="cashflow-card">
                        <h2 data-translate="title_cashflow_analysis">Análisis de Flujo de Caja (<span id="period-name-cf"></span>)</h2>
                        <div class="cashflow-item inflow"><span class="label" data-translate="cf_inflow">(+) Ingreso Real en Banco (Neto de Retenciones)</span><span class="value" id="cf-inflow">0 €</span></div>
                        <div class="cashflow-item outflow"><span class="label" data-translate="cf_your_salary">(-) Tu Sueldo Neto</span><span class="value" id="cf-out-sueldo-propio">0 €</span></div>
                        <div class="cashflow-item outflow"><span class="label" data-translate="cf_employee_salaries">(-) Sueldos Netos Empleados</span><span class="value" id="cf-out-sueldo-empleados">0 €</span></div>
                        <div class="cashflow-item outflow"><span class="label" data-translate="cf_other_expenses">(-) Otros Gastos</span><span class="value" id="cf-out-gastos">0 €</span></div>
                        <div class="cashflow-item outflow"><span class="label" data-translate="cf_autonomo_fee">(-) Tu Cuota de Autónomos</span><span class="value" id="cf-out-cuota">0 €</span></div>
                        <div class="cashflow-result"><span class="label" data-translate="cf_result_label">Superávit / Déficit de Caja</span><span class="value" id="cf-result">0 €</span></div>
                        <p class="cashflow-explanation" data-translate="cf_explanation"><strong>¿Qué significa este dato?</strong> Es el dinero que <strong>realmente te queda en el banco</strong> en el periodo seleccionado después de pagar tus gastos directos. Este 'colchón' es clave para afrontar los impuestos trimestrales (IVA y el IRPF no retenido) y para reinvertir en tu negocio. Un resultado negativo es una alerta de que tus gastos en efectivo superan a tus ingresos.</p>
                    </div>
                </div>
            </section>
        </main>
        <footer><p class="disclaimer" data-translate="main_disclaimer"><strong>Advertencia General:</strong> Este dashboard es una herramienta ilustrativa y sus cálculos se basan en estimaciones y datos estándar. Las leyes fiscales pueden cambiar y su aplicación depende de circunstancias personales. Esta simulación no debe sustituir en ningún caso el asesoramiento de un gestor o asesor fiscal profesional.</p></footer>
    </div>
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- UI & LANGUAGE SETUP ---
        const ui = {
            netoAutonomo: document.getElementById('neto-autonomo'), otrosGastos: document.getElementById('otros-gastos'), iva: document.getElementById('iva'), retencionIrpf: document.getElementById('retencion-irpf'), horasFacturables: document.getElementById('horas-facturables'), employeeList: document.getElementById('employee-list'), addEmployeeBtn: document.getElementById('add-employee'), totalFacturar: document.getElementById('total-facturar'), tarifaHora: document.getElementById('tarifa-hora'), themeToggle: document.getElementById('theme-toggle'), periodSelector: document.getElementById('period-selector'), langSelector: document.getElementById('lang-selector'), periodNameKpi: document.getElementById('period-name-kpi'), periodNameCf: document.getElementById('period-name-cf'), cfInflow: document.getElementById('cf-inflow'), cfOutSueldoPropio: document.getElementById('cf-out-sueldo-propio'), cfOutSueldoEmpleados: document.getElementById('cf-out-sueldo-empleados'), cfOutGastos: document.getElementById('cf-out-gastos'), cfOutCuota: document.getElementById('cf-out-cuota'), cfResult: document.getElementById('cf-result'),
        };
        const translations = {
            es: { main_title: "Dashboard de Facturación para Autónomos en España", subtitle: "Creado por {link}", language_label: "Idioma:", dark_mode_label: "Modo Oscuro", inputs_title_monthly: "1. Tus Datos (Mensuales)", label_your_net_salary: "Tu Sueldo Neto Mensual Deseado (€)", label_your_team: "Tu Equipo (Sueldo Neto Mensual por empleado en €)", btn_add_employee: "+ Añadir Empleado", label_other_expenses: "Otros Gastos Fijos Mensuales (€)", helper_other_expenses: "Ej: alquiler, gestoría, software, etc.", inputs_title_config: "2. Configuración", label_view_mode: "Ver Datos en modo:", period_monthly: "Mensual", period_quarterly: "Trimestral", period_semi_annually: "Semestral", period_annually: "Anual", label_vat_type: "Tipo de IVA a aplicar (%)", label_irpf_withholding: "Retención de IRPF en facturas (%)", label_billable_hours: "Horas Facturables al Mes", kpi_total_billing_label: "🎯 Total a Facturar ({period})", kpi_hourly_rate_label: "💰 Tarifa por Hora (sin IVA)", kpi_hourly_rate_unit: "/ hora", title_visual_breakdown: "Desglose Visual de la Facturación", title_cashflow_analysis: "Análisis de Flujo de Caja ({period})", cf_inflow: "(+) Ingreso Real en Banco (Neto de Retenciones)", cf_your_salary: "(-) Tu Sueldo Neto", cf_employee_salaries: "(-) Sueldos Netos Empleados", cf_other_expenses: "(-) Otros Gastos", cf_autonomo_fee: "(-) Tu Cuota de Autónomos", cf_result_label: "Superávit / Déficit de Caja", cf_explanation: "<strong>¿Qué significa este dato?</strong> Es el dinero que <strong>realmente te queda en el banco</strong> en el periodo seleccionado después de pagar tus gastos directos. Este 'colchón' es clave para afrontar los impuestos trimestrales (IVA y el IRPF no retenido) y para reinvertir en tu negocio. Un resultado negativo es una alerta de que tus gastos en efectivo superan a tus ingresos.", main_disclaimer: "<strong>Advertencia General:</strong> Este dashboard es una herramienta ilustrativa y sus cálculos se basan en estimaciones y datos estándar. Las leyes fiscales pueden cambiar y su aplicación depende de circunstancias personales. Esta simulación no debe sustituir en ningún caso el asesoramiento de un gestor o asesor fiscal profesional.", chart_donut_labels: ['Tu Sueldo Neto', 'Coste Empleados', 'IVA', 'Tu IRPF', 'Otros Gastos', 'Cuota Autónomo'], chart_bar_labels: ['Coste Empleados', 'Tu IRPF', 'Tu Sueldo Neto', 'Otros Gastos', 'Cuota Autónomo'] },
            ca: { main_title: "Dashboard de Facturació per a Autònoms a Espanya", subtitle: "Creat per {link}", language_label: "Idioma:", dark_mode_label: "Mode Fosc", inputs_title_monthly: "1. Les teves Dades (Mensuals)", label_your_net_salary: "El teu Sou Net Mensual Desitjat (€)", label_your_team: "El teu Equip (Sou Net Mensual per empleat en €)", btn_add_employee: "+ Afegeix Empleat", label_other_expenses: "Altres Despeses Fixes Mensuals (€)", helper_other_expenses: "Ex: lloguer, gestoria, software, etc.", inputs_title_config: "2. Configuració", label_view_mode: "Veure Dades en mode:", period_monthly: "Mensual", period_quarterly: "Trimestral", period_semi_annually: "Semestral", period_annually: "Anual", label_vat_type: "Tipus d'IVA a aplicar (%)", label_irpf_withholding: "Retenció d'IRPF en factures (%)", label_billable_hours: "Hores Facturables al Mes", kpi_total_billing_label: "🎯 Total a Facturar ({period})", kpi_hourly_rate_label: "💰 Tarifa per Hora (sense IVA)", kpi_hourly_rate_unit: "/ hora", title_visual_breakdown: "Desglossament Visual de la Facturació", title_cashflow_analysis: "Anàlisi de Flux de Caixa ({period})", cf_inflow: "(+) Ingrés Real al Banc (Net de Retencions)", cf_your_salary: "(-) El teu Sou Net", cf_employee_salaries: "(-) Sous Nets Empleats", cf_other_expenses: "(-) Altres Despeses", cf_autonomo_fee: "(-) La teva Quota d'Autònoms", cf_result_label: "Superàvit / Dèficit de Caixa", cf_explanation: "<strong>Què significa aquesta dada?</strong> Són els diners que <strong>realment et queden al banc</strong> en el període seleccionat després de pagar les teves despeses directes. Aquest 'coixí' és clau per afrontar els impostos trimestrals (IVA i l'IRPF no retingut) i per reinvertir en el teu negoci. Un resultat negatiu és una alerta que les teves despeses en efectiu superen els teus ingressos.", main_disclaimer: "<strong>Advertència General:</strong> Aquest dashboard és una eina il·lustrativa i els seus càlculs es basen en estimacions i dades estàndard. Les lleis fiscals poden canviar i la seva aplicació depèn de circumstàncies personals. Aquesta simulació no ha de substituir en cap cas l'assessorament d'un gestor o assessor fiscal professional.", chart_donut_labels: ['El teu Sou Net', 'Cost Empleats', 'IVA', 'El teu IRPF', 'Altres Despeses', 'Quota Autònom'], chart_bar_labels: ['Cost Empleats', 'El teu IRPF', 'El teu Sou Net', 'Altres Despeses', 'Quota Autònom'] },
            en: { main_title: "Invoicing Dashboard for Freelancers in Spain", subtitle: "Created by {link}", language_label: "Language:", dark_mode_label: "Dark Mode", inputs_title_monthly: "1. Your Data (Monthly)", label_your_net_salary: "Your Desired Monthly Net Salary (€)", label_your_team: "Your Team (Monthly Net Salary per employee in €)", btn_add_employee: "+ Add Employee", label_other_expenses: "Other Monthly Fixed Expenses (€)", helper_other_expenses: "E.g.: rent, agency, software, etc.", inputs_title_config: "2. Configuration", label_view_mode: "View Data as:", period_monthly: "Monthly", period_quarterly: "Quarterly", period_semi_annually: "Semi-annually", period_annually: "Annually", label_vat_type: "VAT Type to apply (%)", label_irpf_withholding: "IRPF Withholding on invoices (%)", label_billable_hours: "Billable Hours per Month", kpi_total_billing_label: "🎯 Total to Invoice ({period})", kpi_hourly_rate_label: "💰 Hourly Rate (excl. VAT)", kpi_hourly_rate_unit: "/ hour", title_visual_breakdown: "Visual Breakdown of Invoicing", title_cashflow_analysis: "Cash Flow Analysis ({period})", cf_inflow: "(+) Actual Bank Income (Net of Withholdings)", cf_your_salary: "(-) Your Net Salary", cf_employee_salaries: "(-) Employees' Net Salaries", cf_other_expenses: "(-) Other Expenses", cf_autonomo_fee: "(-) Your Freelancer Fee", cf_result_label: "Cash Surplus / Deficit", cf_explanation: "<strong>What does this figure mean?</strong> It is the money <strong>you actually have left in the bank</strong> in the selected period after paying your direct expenses. This 'cushion' is key to face quarterly taxes (VAT and non-withheld IRPF) and to reinvest in your business. A negative result is an alert that your cash expenses exceed your income.", main_disclaimer: "<strong>General Disclaimer:</strong> This dashboard is an illustrative tool, and its calculations are based on estimates and standard data. Tax laws can change, and their application depends on personal circumstances. This simulation should in no case replace the advice of a professional manager or tax advisor.", chart_donut_labels: ['Your Net Salary', 'Employee Cost', 'VAT', 'Your IRPF', 'Other Expenses', 'Freelancer Fee'], chart_bar_labels: ['Employee Cost', 'Your IRPF', 'Your Net Salary', 'Other Expenses', 'Freelancer Fee'] },
            gl: { main_title: "Dashboard de Facturación para Autónomos en España", subtitle: "Creado por {link}", language_label: "Idioma:", dark_mode_label: "Modo Escuro", inputs_title_monthly: "1. Os teus Datos (Mensuais)", label_your_net_salary: "O teu Soldo Neto Mensual Desexado (€)", label_your_team: "O teu Equipo (Soldo Neto Mensual por empregado en €)", btn_add_employee: "+ Engadir Empregado", label_other_expenses: "Outros Gastos Fixos Mensuais (€)", helper_other_expenses: "Ex: aluguer, xestoría, software, etc.", inputs_title_config: "2. Configuración", label_view_mode: "Ver Datos en modo:", period_monthly: "Mensual", period_quarterly: "Trimestral", period_semi_annually: "Semestral", period_annually: "Anual", label_vat_type: "Tipo de IVE a aplicar (%)", label_irpf_withholding: "Retención de IRPF en facturas (%)", label_billable_hours: "Horas Facturables ao Mes", kpi_total_billing_label: "🎯 Total a Facturar ({period})", kpi_hourly_rate_label: "💰 Tarifa por Hora (sen IVE)", kpi_hourly_rate_unit: "/ hora", title_visual_breakdown: "Desglose Visual da Facturación", title_cashflow_analysis: "Análise de Fluxo de Caixa ({period})", cf_inflow: "(+) Ingreso Real no Banco (Neto de Retencións)", cf_your_salary: "(-) O teu Soldo Neto", cf_employee_salaries: "(-) Soldos Netos Empregados", cf_other_expenses: "(-) Outros Gastos", cf_autonomo_fee: "(-) A túa Cota de Autónomos", cf_result_label: "Superávit / Déficit de Caixa", cf_explanation: "<strong>Que significa este dato?</strong> Son os cartos que <strong>realmente che quedan no banco</strong> no período seleccionado despois de pagar os teus gastos directos. Este 'colchón' é clave para afrontar os impostos trimestrais (IVE e o IRPF non retido) e para reinvestir no teu negocio. Un resultado negativo é unha alerta de que os teus gastos en efectivo superan os teus ingresos.", main_disclaimer: "<strong>Advertencia Xeral:</strong> Este dashboard é unha ferramenta ilustrativa e os seus cálculos baséanse en estimacións e datos estándar. As leis fiscais poden cambiar e a súa aplicación depende de circunstancias persoais. Esta simulación non debe substituír en ningún caso o asesoramento dun xestor ou asesor fiscal profesional.", chart_donut_labels: ['O teu Soldo Neto', 'Custo Empregados', 'IVE', 'O teu IRPF', 'Outros Gastos', 'Cota Autónomo'], chart_bar_labels: ['Custo Empregados', 'O teu IRPF', 'O teu Soldo Neto', 'Outros Gastos', 'Cota Autónomo'] },
            eu: { main_title: "Autonomoentzako Fakturazio Arbel Digitala Espainian", subtitle: "{link}-k sortua", language_label: "Hizkuntza:", dark_mode_label: "Modu Iluna", inputs_title_monthly: "1. Zure Datuak (Hilero)", label_your_net_salary: "Nahi duzun Hileko Soldata Garbia (€)", label_your_team: "Zure Taldea (Hileko Soldata Garbia langile bakoitzeko €-tan)", btn_add_employee: "+ Gehitu Langilea", label_other_expenses: "Beste Hileko Gastu Finkoak (€)", helper_other_expenses: "Adib: alokairua, gestoria, softwarea, etab.", inputs_title_config: "2. Konfigurazioa", label_view_mode: "Ikusi Datuak honela:", period_monthly: "Hilero", period_quarterly: "Hiruhileko", period_semi_annually: "Seihileko", period_annually: "Urtero", label_vat_type: "Aplikatu beharreko BEZ mota (%)", label_irpf_withholding: "PFEZ-ren atxikipena fakturetan (%)", label_billable_hours: "Hilean Fakturatzeko Orduak", kpi_total_billing_label: "🎯 Fakturatu beharreko Guztira ({period})", kpi_hourly_rate_label: "💰 Orduko Tarifa (BEZ gabe)", kpi_hourly_rate_unit: "/ orduko", title_visual_breakdown: "Fakturazioaren Ikusizko Banaketa", title_cashflow_analysis: "Kutxa Fluxuaren Analisia ({period})", cf_inflow: "(+) Bankuko Benetako Sarrera (Atxikipen Garbiak)", cf_your_salary: "(-) Zure Soldata Garbia", cf_employee_salaries: "(-) Langileen Soldata Garbiak", cf_other_expenses: "(-) Beste Gastu Batzuk", cf_autonomo_fee: "(-) Zure Autonomo Kuota", cf_result_label: "Kutxako Superabita / Defizita", cf_explanation: "<strong>Zer esan nahi du datu honek?</strong> Zure gastu zuzenak ordaindu ondoren hautatutako aldian <strong>bankuan benetan geratzen zaizun dirua</strong> da. 'Kuxin' hau funtsezkoa da hiruhileko zergak (BEZa eta atxiki gabeko PFEZa) ordaintzeko eta zure negozioan berrinbertitzeko. Emaitza negatiboa zure eskudiruzko gastuek zure sarrerak gainditzen dituztela adierazten duen alerta da.", main_disclaimer: "<strong>Ohar Orokorra:</strong> Arbel digital hau tresna adierazgarri bat da eta bere kalkuluak estimazioetan eta datu estandarretan oinarritzen dira. Lege fiskalak alda daitezke eta beren aplikazioa egoera pertsonalen araberakoa da. Simulazio honek ez du inola ere gestore edo aholkulari fiskal profesional baten aholkularitza ordezkatu behar.", chart_donut_labels: ['Zure Soldata Garbia', 'Langileen Kostua', 'BEZa', 'Zure PFEZa', 'Beste Gastuak', 'Autonomo Kuota'], chart_bar_labels: ['Langileen Kostua', 'Zure PFEZa', 'Zure Soldata Garbia', 'Beste Gastuak', 'Autonomo Kuota'] },
            oc: { main_title: "Panèu de Facturacion entà Autonòms en Espanha", subtitle: "Creat per {link}", language_label: "Lengua:", dark_mode_label: "Mòde Escur", inputs_title_monthly: "1. Es tues Dades (Mensuaus)", label_your_net_salary: "Eth Tòn Salari Net Mesader Desirat (€)", label_your_team: "Eth Tòn Equip (Salari Net Mesader per empleat en €)", btn_add_employee: "+ Afegeish Empleat", label_other_expenses: "Autes Despenses Fixes Mesadères (€)", helper_other_expenses: "Ex: loguèr, gestoria, logiciau, etc.", inputs_title_config: "2. Configuracion", label_view_mode: "Veir Dades en mòde:", period_monthly: "Mesader", period_quarterly: "Trimestrau", period_semi_annually: "Semestrau", period_annually: "Annau", label_vat_type: "Tipe de TVA a aplicar (%)", label_irpf_withholding: "Retencion de IRPF en factures (%)", label_billable_hours: "Ores Facturables ath Mes", kpi_total_billing_label: "🎯 Totau a Facturar ({period})", kpi_hourly_rate_label: "💰 Tarifa per Ora (sense TVA)", kpi_hourly_rate_unit: "/ ora", title_visual_breakdown: "Desglossament Visuau dera Facturacion", title_cashflow_analysis: "Analisi de Flux de Caixa ({period})", cf_inflow: "(+) Ingression Reau en Banc (Net de Retencions)", cf_your_salary: "(-) Eth Tòn Salari Net", cf_employee_salaries: "(-) Salaris Nets Empleats", cf_other_expenses: "(-) Autes Despenses", cf_autonomo_fee: "(-) Era tua Quòta d'Autonòms", cf_result_label: "Superavit / Deficit de Caixa", cf_explanation: "<strong>Qué vò díder aguesta dada?</strong> Son es sòs que <strong>reaument te demoren ena banca</strong> en periòde seleccionat dempús de pagar es tues despenses dirèctes. Aguest 'coishin' ei clau entà afrontar es impòsti trimestraus (TVA e er IRPF non retengut) e entà reinvertir en tòn negoci. Un resultat negatiu ei ua alèrta que es tues despenses en efectiu superen es tòns ingressi.", main_disclaimer: "<strong>Advertiment Generau:</strong> Aguest panèu ei un esturment illustratiu e es sòns calculs se basen en estimacions e dades estandard. Es leis fiscaus pòden cambiar e era sua aplicacion depen de circonstàncies personaus. Aguesta simulacion non a de substituir en cap de cas er assessorament d'un gestor o assessor fiscau professionau.", chart_donut_labels: ['Tòn Salari Net', 'Còst Empleats', 'TVA', 'Tòn IRPF', 'Autes Despenses', 'Quòta Autonòm'], chart_bar_labels: ['Còst Empleats', 'Tòn IRPF', 'Tòn Salari Net', 'Autes Despenses', 'Quòta Autonòm'] },
        };
        const languages = { es: "Español", ca: "Català", en: "English", gl: "Galego", eu: "Euskara", oc: "Aranés" };
        const periods = { es: {1:"Mensual", 3:"Trimestral", 6:"Semestral", 12:"Anual"}, ca: {1:"Mensual", 3:"Trimestral", 6:"Semestral", 12:"Anual"}, en: {1:"Monthly", 3:"Quarterly", 6:"Semi-annually", 12:"Annually"}, gl: {1:"Mensual", 3:"Trimestral", 6:"Semestral", 12:"Anual"}, eu: {1:"Hilero", 3:"Hiruhileko", 6:"Seihileko", 12:"Urtero"}, oc: {1:"Mesader", 3:"Trimestrau", 6:"Semestrau", 12:"Annau"} };

        // --- CORE FUNCTIONS ---
        const formatCurrency = (v) => new Intl.NumberFormat('es-ES', { style: 'currency', currency: 'EUR' }).format(v);
        const getCuotaAutonomo = (r) => { if (r <= 670) return 225; if (r <= 900) return 267; if (r <= 1166.70) return 275; if (r <= 1300) return 291; if (r <= 1500) return 294; if (r <= 1700) return 310; if (r <= 1850) return 315; if (r <= 2030) return 320; if (r <= 2330) return 330; if (r <= 2760) return 350; if (r <= 3190) return 370; if (r <= 3620) return 390; if (r <= 4050) return 420; if (r <= 6000) return 450; return 530; };
        const getIRPF = (b) => { let i = 0, r = b; if (r > 300000) { i += (r - 300000) * 0.47; r = 300000; } if (r > 60000) { i += (r - 60000) * 0.45; r = 60000; } if (r > 35200) { i += (r - 35200) * 0.37; r = 35200; } if (r > 20200) { i += (r - 20200) * 0.30; r = 20200; } if (r > 12450) { i += (r - 12450) * 0.24; r = 12450; } i += r * 0.19; return Math.max(0, i); };
        
        function setLanguage(lang) {
            const t = translations[lang] || translations.es;
            document.documentElement.lang = lang;
            document.querySelectorAll('[data-translate]').forEach(el => {
                const key = el.dataset.translate;
                if (t[key]) {
                    if (key === 'subtitle') {
                        el.innerHTML = t[key].replace('{link}', '<a href="https://www.linkedin.com/in/oriol-badia" target="_blank" rel="noopener noreferrer">Oriol Badia Campanera</a>');
                    } else if (key.includes('kpi_total_billing_label') || key.includes('title_cashflow_analysis')) {
                        // These are handled dynamically in calculateAll
                    } else {
                        el.innerHTML = t[key];
                    }
                }
            });
            ui.periodSelector.innerHTML = '';
            for (const [value, name] of Object.entries(periods[lang] || periods.es)) {
                const option = document.createElement('option');
                option.value = value;
                option.textContent = name;
                ui.periodSelector.appendChild(option);
            }
            if (localStorage.getItem('period')) ui.periodSelector.value = localStorage.getItem('period');

            localStorage.setItem('language', lang);
            calculateAll();
        }

        function calculateAll() {
            const lang = ui.langSelector.value || 'es';
            const t = translations[lang] || translations.es;
            const netoAutonomoMensual = parseFloat(ui.netoAutonomo.value) || 0; const otrosGastosMensual = parseFloat(ui.otrosGastos.value) || 0; const ivaRate = parseFloat(ui.iva.value); const retencionRate = parseFloat(ui.retencionIrpf.value); const horasFacturablesMensual = parseFloat(ui.horasFacturables.value) || 1;
            const multiplier = parseFloat(ui.periodSelector.value); const periodName = ui.periodSelector.options[ui.periodSelector.selectedIndex].text;
            document.querySelector('[data-translate="kpi_total_billing_label"]').innerHTML = t.kpi_total_billing_label.replace('{period}', periodName);
            document.querySelector('[data-translate="title_cashflow_analysis"]').innerHTML = t.title_cashflow_analysis.replace('{period}', periodName);
            
            let totalCosteEmpleadosMensual = 0; let sueldosNetosEmpleadosMensual = 0;
            document.querySelectorAll('.employee-net-salary').forEach(input => { const netoEmpleado = parseFloat(input.value) || 0; if (netoEmpleado > 0) { sueldosNetosEmpleadosMensual += netoEmpleado; totalCosteEmpleadosMensual += (netoEmpleado / 0.80) * 1.32; }});
            let baseImponibleMensual = netoAutonomoMensual + otrosGastosMensual + totalCosteEmpleadosMensual; let provisionIRPFMensual = 0, cuotaAutonomoMensual = 0;
            for (let i = 0; i < 10; i++) { let rPrevio = netoAutonomoMensual + otrosGastosMensual + totalCosteEmpleadosMensual; cuotaAutonomoMensual = getCuotaAutonomo(baseImponibleMensual - otrosGastosMensual - totalCosteEmpleadosMensual - provisionIRPFMensual); let rTotal = rPrevio + cuotaAutonomoMensual; provisionIRPFMensual = getIRPF(rTotal * 12) / 12; baseImponibleMensual = rTotal + provisionIRPFMensual; }
            const tarifaHora = baseImponibleMensual / horasFacturablesMensual;
            const baseImponiblePeriodo = baseImponibleMensual * multiplier; const ivaPeriodo = baseImponibleMensual * ivaRate * multiplier;
            ui.totalFacturar.textContent = formatCurrency(baseImponiblePeriodo + ivaPeriodo);
            ui.tarifaHora.textContent = formatCurrency(tarifaHora);
            updateCharts({ sueldoNeto: netoAutonomoMensual * multiplier, costeEmpleados: totalCosteEmpleadosMensual * multiplier, iva: ivaPeriodo, irpf: provisionIRPFMensual * multiplier, otrosGastos: otrosGastosMensual * multiplier, cuotaAutonomo: cuotaAutonomoMensual * multiplier }, lang);
            const retencionSufridaPeriodo = baseImponiblePeriodo * retencionRate; const ingresoRealBancoPeriodo = (baseImponiblePeriodo + ivaPeriodo) - retencionSufridaPeriodo; const totalSalidasDirectasPeriodo = (netoAutonomoMensual + sueldosNetosEmpleadosMensual + otrosGastosMensual + cuotaAutonomoMensual) * multiplier; const resultadoCajaPeriodo = ingresoRealBancoPeriodo - totalSalidasDirectasPeriodo;
            ui.cfInflow.textContent = formatCurrency(ingresoRealBancoPeriodo); ui.cfOutSueldoPropio.textContent = formatCurrency(netoAutonomoMensual * multiplier); ui.cfOutSueldoEmpleados.textContent = formatCurrency(sueldosNetosEmpleadosMensual * multiplier); ui.cfOutGastos.textContent = formatCurrency(otrosGastosMensual * multiplier); ui.cfOutCuota.textContent = formatCurrency(cuotaAutonomoMensual * multiplier);
            ui.cfResult.textContent = formatCurrency(resultadoCajaPeriodo); ui.cfResult.className = `value ${resultadoCajaPeriodo >= 0 ? 'positive' : 'negative'}`;
        }
        const donutCtx = document.getElementById('donutChart').getContext('2d'); const barCtx = document.getElementById('barChart').getContext('2d');
        const getChartColors = () => { const d = document.documentElement.getAttribute('data-theme') === 'dark'; return { grid: d ? 'rgba(255,255,255,0.1)' : 'rgba(0,0,0,0.1)', label: d ? '#94a3b8' : '#5a677d', colors: ['#2563eb', '#db2777', '#f59e0b', '#ef4444', '#8b5cf6', '#10b981'], border: d ? '#1e293b' : '#ffffff' }; };
        const donutChart = new Chart(donutCtx, { type: 'doughnut', data: { labels: [], datasets: [{ data: [], borderWidth: 3, hoverOffset: 4 }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom', labels: { padding: 15, boxWidth: 12, font: { size: 12 } } }, tooltip: { callbacks: { label: (c) => `${c.label}: ${formatCurrency(c.raw)}` } } }, cutout: '60%' } });
        const barChart = new Chart(barCtx, { type: 'bar', data: { labels: [], datasets: [{ label: 'Costes e Impuestos (€)', data: [], borderRadius: 4 }] }, options: { indexAxis: 'y', responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { x: { ticks: { callback: (v) => formatCurrency(v)}, grid: {} }, y: { ticks: {}, grid: { drawOnChartArea: false } } } } });
        function updateCharts(data, lang) { const c = getChartColors(); const t = translations[lang] || translations.es; donutChart.data.labels = t.chart_donut_labels; donutChart.data.datasets[0].data = Object.values(data); donutChart.options.plugins.legend.labels.color = c.label; donutChart.data.datasets[0].backgroundColor = c.colors; donutChart.options.borderColor = c.border; donutChart.update(); barChart.data.labels = t.chart_bar_labels; barChart.data.datasets[0].data = [data.costeEmpleados, data.irpf, data.sueldoNeto, data.otrosGastos, data.cuotaAutonomo]; barChart.options.scales.x.ticks.color = c.label; barChart.options.scales.y.ticks.color = c.label; barChart.options.scales.x.grid.color = c.grid; barChart.data.datasets[0].backgroundColor = c.colors.slice(1); barChart.update(); }
        
        // --- EVENT LISTENERS ---
        [ui.netoAutonomo, ui.otrosGastos, ui.iva, ui.retencionIrpf, ui.horasFacturables, ui.periodSelector].forEach(el => el.addEventListener('input', calculateAll));
        ui.addEmployeeBtn.addEventListener('click', () => { const i = document.createElement('div'); i.className = 'employee-item'; i.innerHTML = `<input type="number" class="input-field employee-net-salary" value="1500" min="0" placeholder="Sueldo neto"><button class="remove-btn" aria-label="Eliminar">X</button>`; ui.employeeList.appendChild(i); calculateAll(); });
        ui.employeeList.addEventListener('click', (e) => { if (e.target.classList.contains('remove-btn')) { e.target.parentElement.remove(); calculateAll(); } });
        ui.employeeList.addEventListener('input', (e) => { if (e.target.classList.contains('employee-net-salary')) { calculateAll(); } });
        ui.themeToggle.addEventListener('change', () => { const t = ui.themeToggle.checked ? 'dark' : 'light'; document.documentElement.setAttribute('data-theme', t); localStorage.setItem('theme', t); calculateAll(); });
        ui.langSelector.addEventListener('change', (e) => setLanguage(e.target.value));
        ui.periodSelector.addEventListener('change', (e) => { localStorage.setItem('period', e.target.value); calculateAll(); });

        // --- INITIALIZATION ---
        for (const [code, name] of Object.entries(languages)) { const option = document.createElement('option'); option.value = code; option.textContent = name; ui.langSelector.appendChild(option); }
        const savedLang = localStorage.getItem('language') || navigator.language.split('-')[0];
        ui.langSelector.value = translations[savedLang] ? savedLang : 'es';
        const savedTheme = localStorage.getItem('theme'); if (savedTheme) { document.documentElement.setAttribute('data-theme', savedTheme); ui.themeToggle.checked = savedTheme === 'dark'; } else if (window.matchMedia?.('(prefers-color-scheme: dark)').matches) { document.documentElement.setAttribute('data-theme', 'dark'); ui.themeToggle.checked = true; }
        setLanguage(ui.langSelector.value);
    });
    </script>
</body>
</html>